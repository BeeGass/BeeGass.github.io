name: GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3
        
      - name: Install build essentials aka gcc
        run: sudo apt install build-essential

      - name: Install nodejs
        run: sudo apt-get install nodejs
        
      - run: gem install nokogiri --platform=ruby
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.0' # Not needed with a .ruby-version file
          bundler-cache: true # runs 'bundle install' and caches installed gems automatically
      - run: bundle check
        
      - name: install execjs
        run: gem install execjs

      - name: convert notebooks and word docs to posts
        uses: fastai/fastpages@master
        with:
          BOOL_SAVE_MARKDOWN: false
          SSH_DEPLOY_KEY: ${{ secrets.SSH_DEPLOY_KEY }}

      - name: Build the site in the jekyll/builder container
        run: |
          docker run \
          -v ${{ github.workspace }}:/srv/jekyll -v ${{ github.workspace }}/_site:/srv/jekyll/_site \
          jekyll/builder:latest /bin/bash -c "chmod a+w /srv/jekyll/Gemfile.lock && chmod 777 /srv/jekyll && jekyll build --future"
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site
          allow_empty_commit: true
          enable_jekyll: true
          publish_branch: gh-pages
          cname: https://beegass.dev/


      # - name: Build the site in the jekyll/builder container
      #   run: |
      #     docker run \
      #     -v ${{ github.workspace }}:/srv/jekyll -v ${{ github.workspace }}/_site:/srv/jekyll/_site \
      #     jekyll/builder:latest /bin/bash -c "chmod a+w /srv/jekyll/Gemfile.lock && chmod 777 /srv/jekyll && jekyll build --future"

      # - name: Install And Build
      #   uses: helaili/jekyll-action@v2
      #   with:
      #     token: ${{ secrets.GITHUB_TOKEN }}

      # - name: Jekyll build
      #   uses: docker://jekyll/jekyll
      #   with:
      #     args: jekyll build --trace
